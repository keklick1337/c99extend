# c99extend

**Extend library for C99 programming language**  
Author: [Vladislav Tislenko aka keklick1337](https://github.com/keklick1337)  
Year: 2025  

This repository provides an extended UTF-8 string library in pure C99. It includes functionality for:
- Managing dynamic strings with length and capacity tracking.
- Validating and handling UTF-8 data (including BOM detection and removal).
- Normalizing line endings (CRLF vs. LF).
- Basic string operations: concatenation, summation, push-back, etc.

---

## Features Overview

1. **`String` structure**  
   - Stores a character buffer (`data`), current length (`len`), and capacity (`cap`).

2. **UTF-8 validation**  
   - Ensures strings contain valid UTF-8 sequences per [RFC 3629](https://datatracker.ietf.org/doc/html/rfc3629), detecting invalid bytes, overlong encodings, surrogates, etc.

3. **BOM (Byte Order Mark) support**  
   - Automatically removes the UTF-8 BOM (`0xEF 0xBB 0xBF`) if present.

4. **CRLF / LF normalization**  
   - Strips trailing `\r` and/or `\n` from the end of a string.

5. **Basic operations**  
   - Create from C-string  
   - Free and reallocate  
   - Push back a single character  
   - Concatenate strings (in-place or return a new one)  
   - Retrieve `const char*` for printing (`printf("%s", str_data(...))`)  

---

## Repository Structure

```text
c99extend/
├── LICENSE                 # MIT License
├── configure               # Minimal script to detect compiler & generate Makefile
├── strings/
│   ├── string_utf8.c       # Implementation of the extended UTF-8 library
│   └── string_utf8.h       # Header file for the extended UTF-8 library
├── tests/
│   └── string_utf8_test.c  # Test code to demonstrate usage, BOM handling, etc.
├── test_files/
│   ├── test_utf8_bom.txt   # UTF-8 text file with BOM
│   └── test_utf8_nobom.txt # UTF-8 text file without BOM
└── (Makefile is generated by `./configure`)
```

---

## Quick Start

1. **Clone the repository**  
   ```bash
   git clone https://github.com/keklick1337/c99extend.git
   cd c99extend
   ```

2. **Run `configure`**  
   ```bash
   ./configure
   ```
   This script detects a suitable C compiler (Clang or GCC) and creates a `Makefile` with default settings.

3. **Build the library and tests**  
   ```bash
   make
   ```
   - Produces a static library: **`libstring_utf8.a`**  
   - Produces the test executable: **`string_utf8_test`**  

4. **Run the tests**  
   ```bash
   make run
   ```
   or
   ```bash
   ./string_utf8_test
   ```
   This will demonstrate various scenarios:
   - Basic string concatenation  
   - UTF-8 validation (valid vs. invalid)  
   - BOM removal  
   - CRLF stripping  
   - Reading from `test_files/test_utf8_bom.txt` and `test_files/test_utf8_nobom.txt`

5. **Clean up**  
   ```bash
   make clean
   ```
   Removes compiled objects, library archives, and the test executable.

---

## Usage in Your Own Project

1. Copy `string_utf8.h` and `string_utf8.c` into your project, or build the static library and link against it.
2. Include the header in your source:
   ```c
   #include "string_utf8.h"

   int main(void) {
       String s = str_from_cstr("Hello, World!");
       if (str_preflight_utf8(&s)) {
           printf("Valid UTF-8: %s\n", str_data(&s));
       }
       str_free(&s);
       return 0;
   }
   ```
3. Compile and link:
   ```bash
   gcc -std=c99 main.c string_utf8.c -o my_app
   ./my_app
   ```

Or, if using the static library:
   ```bash
   gcc -std=c99 main.c -L. -lstring_utf8 -o my_app
   ./my_app
   ```

---

## License

This project is distributed under the [MIT License](LICENSE).  
You are free to use, modify, and distribute this software under the conditions described in the license file.

---

## Author & Credits

- **Author**: Vladislav Tislenko aka **keklick1337**  
- **Year**: 2025  
- **Description**: Extended UTF-8 library for C99, providing additional features often needed in modern string handling, such as BOM removal, validation, and improved memory management.

**Enjoy coding with extended C99 strings!**